---
sudo: false
dist: trusty
language: ruby
cache: bundler
before_install:
  - bundle -v
  - rm Gemfile.lock || true
  - gem update --system
  - gem update bundler
  - gem --version
  - bundle -v
  - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
script:
  - 'bundle exec rake $CHECK'
bundler_args: --without system_tests
rvm:
  - 2.4.1
  - 2.1.9
env:
   global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "Y7IS8qfBkPuQPU9wzrGORY5KFAMUmnTnNDUAosW/yclRpyjcY65FrrCLI0z0hobGZ3inNnZh7FCg0TVV9GceLA6x1FkgpU8F63j3PYL9fE/EX14fR6n5I+O0xpfPNrcSaXYR5zHd1TJhZNKeTA7dWSZpYlRTcW1AmrFZqT00kYzi1snNAEp7+NLG3e74e9kObsWwtTzfA9Xx71bvvk/M8eTgugNyyeO+7rUToByW/ryPUNBmRbFNUbgjhLdIZFRE9iKUQcINt8lTx8dCeAKtrorouX4mtMSRO0cF8rHJ6QzzZ6IESEwMxOVmtjm+4/H56aSawQrUB/wnQQiNNRUIWVsCMckvHe6pcg5QC+O56KF/KEdnGsKfSLvkCxUTGKi7u+QsUzWFolxuzZcbJam8wXF5T6ynbba4pa00pQb/mZFFA/ppAtTq/14+7Hdk6iebqBTFrpGKt9Y9u/d2JIp5Fr8SqRCiBWkNtybJf8PcMW91DFn2WNAsLStLuQT0hcfNDzYEqxlVC3GC6K9I+qL8Rkp3d/eKAYoJASfIVlTWys/a5QzIk9dbn+jOj1gWxN/VjMvyGnDy4kmt9oQ8VvmGubF80qwKueVG6A4qCwznfV912/XLXbSlbi3/6lVLD6/cnDuKR1UIFs7E4moPJpC6kmWbCjFqepdPWwC947ZoNlo="

   - PUPPET_GEM_VERSION="~> 4.0" CHECK=spec

addons:
  coverity_scan:
    project:
      name: "revolutionsystem/puppet-snoopy"
      description: "Build submitted via Travis CI"
    notification_email: revolutionsystem10@gmail.com
    build_command_prepend: ""
    build_command:   ""
    branch_pattern: coverity_scan

matrix:
  fast_finish: true
  include:
    -
      env: CHECK=rubocop
    -
      env: CHECK="syntax lint"
    -
      env: CHECK=metadata_lint
branches:
  only:
    - master
    - /^v\d/
notifications:
  email: false
deploy:
  provider: puppetforge
  user: puppet
  password:
    secure: ""
  on:
    tags: true
    all_branches: true
    condition: "$DEPLOY_TO_FORGE = yes"
